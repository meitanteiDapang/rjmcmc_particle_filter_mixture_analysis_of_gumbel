---
title: "DIC-k"
output: html_document
---


## data

```{r}
source("../dir_manager.r")
source(file.path(dir_path,"rjmcmc_normal/mcmc_k.r"))
source(file.path(dir_path,"rjmcmc_common/DIC.r"))

set.seed(6291117)
n <-  200
# Generate Data
pi.1 <- 2/10
pi.2 <- 3/10
pi.3 <- 5/10

k <- 3
sim_pi <- c(pi.1, pi.2, pi.3)

sim_mu <- c( -5,    0,    5)
sim_tau <- c(2, 5, 1)
sim_sigma <- 1/sqrt(sim_tau)

y <- c()
for(i in c(1:k)){
  y.k <- rnorm(n*sim_pi[i], mean = sim_mu[i], sd = sim_sigma[i])
  cat("simulated mu k= ",i," :", mean(y.k), "\n")
  cat("simulated tau k= ",i," :", 1/sd(y.k)^2, "\n")
  y <- c(y, y.k)
}

X <- sample(y)

# prior
xi <- 0
kappa <- 0.001
alpha <- 0.1
beta <- 0.1
delta <- 1


set.seed(6291117)
iter <- 50000
burn.in <- iter/5

```

## k = 3

```{r}
# k = 3



k = 3
mu <- rnorm(k,xi, sqrt(1/kappa))
tau <- rgamma(k, alpha, beta)
pi <- rdirichlet(1, rep(1, k))
Z <- rep(1:k, length.out=length(X))
est <- mcmc_mixture_normal_k(iter, X, 
                          xi,kappa,alpha,beta,delta,
                          mu, tau, pi, Z
                          )
est_k3 <- est[[1]]
```




```{r}
source(file.path(dir_path,"rjmcmc_common/rjmcmc_plot.r"))
pp <- plot_sixpanel_trace_density(
  est_k3, burn.in, iter,
  truths = list(mu = sim_mu, tau = sim_tau, pi = sim_pi),
  trace_alpha = 0.25,
  legend_position = "bottom",
  panel_label_size = 10
)
ggsave(
  file.path(pic_path, "rjmcmc_normal", "DIC_k", "k3", "k3.png"),
  pp,
  width = 8,
  height = 10
)


```



## k = 2

```{r}
set.seed(6291117)
k <- 2
mu <- rnorm(k,xi,kappa)
tau <- rgamma(k, alpha, beta)
pi <- rdirichlet(1, rep(1, k))
Z <- rep(1:k, length.out=length(X))
est <- mcmc_mixture_normal_k(iter, X, 
                          xi,kappa,alpha,beta,delta,
                          mu, tau, pi, Z,
                          k
                          )
est_k2 <- est[[1]]
```

```{r}
source(file.path(dir_path,"rjmcmc_common/rjmcmc_plot.r"))
pp <- plot_sixpanel_trace_density(
  est_k2, 2.5* burn.in, iter,
  truths = list(mu = sim_mu, tau = sim_tau, pi = sim_pi),
  trace_alpha = 0.25,
  legend_position = "bottom",
  panel_label_size = 10
)
ggsave(
  file.path(pic_path, "rjmcmc_normal", "DIC_k", "k2", "k2.png"),
  pp,
  width = 8,
  height = 10
)
```



## k = 4

```{r}
set.seed(6291117)
k <- 4
mu <- rnorm(k,xi,kappa)
tau <- rgamma(k, alpha, beta)
pi <- rdirichlet(1, rep(1, k))
Z <- rep(1:k, length.out=length(X))
est <- mcmc_mixture_normal_k(iter, X, 
                          xi,kappa,alpha,beta,delta,
                          mu, tau, pi, Z,
                          k
                          )
est_k4 <- est[[1]]
```

```{r}
# plot_trace_and_density(est_k4, burn.in, iter, "mu", truth=sim_mu)   # for mu
# plot_trace_and_density(est_k4, burn.in, iter, "tau", truth=sim_tau)  # for tau
# plot_trace_and_density(est_k4, burn.in, iter, "pi", truth=sim_pi)   # for pi
source(file.path(dir_path,"rjmcmc_common/rjmcmc_plot.r"))
pp <- plot_sixpanel_trace_density(
  est_k4,  burn.in, iter,
  truths = list(mu = sim_mu, tau = sim_tau, pi = sim_pi),
  trace_alpha = 0.25,
  legend_position = "bottom",
  panel_label_size = 10,
  mu_range = c(-10, 10),
  tau_range = c(0, 10)
)
pp
ggsave(
  file.path(pic_path, "rjmcmc_normal", "DIC_k", "k4", "k4.png"),
  pp,
  width = 8,
  height = 10
)

```



## Compute DIC

```{r}
source(file.path(dir_path,"rjmcmc_common/DIC.r"))
DIC2 <- compute_DIC(2, est_k2, X, 2.5 * burn.in, iter)
DIC3 <- compute_DIC(3, est_k3, X, burn.in, iter)
DIC4 <- compute_DIC(4, est_k4, X, burn.in, iter)
cat("DIC2: ", DIC2, "\n")
cat("DIC3: ", DIC3, "\n")
cat("DIC4: ", DIC4, "\n")
```

## data merged

```{r}
source("../dir_manager.r")
source(file.path(dir_path,"rjmcmc_normal/mcmc_k.r"))
source(file.path(dir_path,"rjmcmc_common/DIC.r"))

n <-  100
# Generate Data
set.seed(123)
pi.1 <- 2/10
pi.2 <- 3/10
pi.3 <- 5/10

sim_mu <- c( -5,    0,    5)
sim_tau <- c(0.3, 0.3, 0.3)

X.1 <- rnorm(pi.1 * n, sim_mu[1], 1/sqrt(sim_tau[1]) )
X.2 <- rnorm(pi.2 * n, sim_mu[2], 1/sqrt(sim_tau[2]) )
X.3 <- rnorm(pi.3 * n, sim_mu[3], 1/sqrt(sim_tau[3]) )

X <- c(X.1,X.2,X.3)
index <- sample(length(X))
X <- X[index]

# prior
xi <- 0
kappa <- 0.001
alpha <- 0.001
beta <- 0.001
delta <- 1

```

### k = 3

```{r}
# k = 3
set.seed(6291117)
iter <- 50000
burn.in <- iter/2


k = 3
mu <- rnorm(k,xi, sqrt(1/kappa))
tau <- rgamma(k, alpha, beta)
pi <- rdirichlet(1, rep(1, k))
Z <- rep(1:k, length.out=length(X))
est <- mcmc_mixture_normal_k(iter, X, 
                          xi,kappa,alpha,beta,delta,
                          mu, tau, pi, Z
                          )
est_k3 <- est[[1]]
```


```{r}
source(file.path(dir_path,"rjmcmc_common/rjmcmc_plot.r"))
plot_trace_and_density(est_k3, burn.in, iter, "mu")   # for mu
plot_trace_and_density(est_k3, burn.in, iter, "tau")  # for tau
plot_trace_and_density(est_k3, burn.in, iter, "pi")   # for pi
```

